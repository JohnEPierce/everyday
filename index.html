<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<title>Photo everyday</title>
</head>


<body>
	<script type="text/javascript">
		$(document).ready(function() {
		  const startAgeDays = 3;
		  const endAgeDays   = 1075;
		  const fps          = 10;
		  const totalFrames  = 983;
		  const video        = document.getElementById("agevideo");
		  const textDisplay  = $(".text");
		  const loadingIndicator = $(".loading");
		
		  // --- rAF seek scheduling ---
		  let targetTime = null;
		  let ticking = false;
		
		  function applySeek() {
			if (targetTime !== null) {
			  video.currentTime = targetTime;
			  targetTime = null;
			}
			ticking = false;
		  }
		
		  function requestSeek(time) {
			targetTime = time;
			if (!ticking) {
			  requestAnimationFrame(applySeek);
			  ticking = true;
			}
		  }
		
		  function updateFrameFromX(mouseX) {
			const holder       = $(".holder");
			const holderOffset = holder.offset().left;
			const holderWidth  = holder.width();
		
			let frameIndex;
			const leftEdge  = holderOffset;
			const rightEdge = holderOffset + holderWidth;
		
			if (mouseX < leftEdge) {
			  frameIndex = 0;
			} else if (mouseX > rightEdge) {
			  frameIndex = totalFrames - 1;
			} else {
			  const relativeX = mouseX - leftEdge;
			  frameIndex = Math.round(relativeX * (totalFrames - 1) / holderWidth);
			}
		
			// âœ… schedule the seek
			requestSeek(frameIndex / fps);
		
			// update age text immediately
			const ageInDays = startAgeDays + frameIndex * ((endAgeDays - startAgeDays) / (totalFrames - 1));
			textDisplay.text(formatAge(ageInDays));
		  }
		
		  // --- unlock video on first touch (Safari fix) ---
		  $(".holder").on("touchstart", function() {
			if (video.paused) {
			  video.play().then(() => video.pause());
			}
		  });
		
		  video.addEventListener("loadedmetadata", () => {
			loadingIndicator.fadeOut(200, function(){ $(this).remove(); });
		
			// Mouse support (across whole window)
			$(document).on("mousemove", function(event) {
			  updateFrameFromX(event.pageX);
			});
		
			// Touch support (across whole window too)
			$(document).on("touchstart touchmove", function(event) {
			  const touch = event.originalEvent.touches[0];
			  updateFrameFromX(touch.pageX);
			  event.preventDefault(); // stop page scrolling
			});
		  });
		
		  function formatAge(days) {
			const years  = Math.floor(days / 365);
			const rem    = days - years*365;
			const months = Math.floor(rem / 30.44);
			const d      = Math.floor(rem - months*30.44);
			return years > 0
			  ? `${years} yr, ${months} months & ${d} days`
			  : `${months} months & ${d} days`;
		  }
		});
		</script>
<div class="holder">
	<div class="loading">Loading images...</div>
	<video id="agevideo" preload="auto" playsinline muted>
	  <source src="son-age.webm" type="video/webm">
	  <source src="son-age.mp4" type="video/mp4">
	  Your browser does not support the video tag.
	</video>
	<div class="text"></div>
  </div>
</body>
</html>
