<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<title>Photo everyday</title>
</head>


<body>
<script type="text/javascript">
 $(document).ready(function() {
	const startAgeDays = 3;
		
	const totalImages = 983;
	const agePerImage = 1075/(totalImages-1);
	const mainImage = $(".mainpic");
	const loadingIndicator = $(".loading");
	const textDisplay = $(".text");

	textDisplay.text(formatAge(startAgeDays));

	function preloadImages(onComplete) {
		const cache = [];
		const schedule = window.requestIdleCallback
			? (cb) => requestIdleCallback(cb, { timeout: 200 })
			: (cb) => setTimeout(cb, 0);

		const loadNext = (index) => {
			if (index >= totalImages) {
				if (typeof onComplete === "function") {
					onComplete();
				}
				return;
			}

			const img = new Image();
			img.decoding = "async";
			const advance = () => schedule(() => loadNext(index + 1));
			img.onload = advance;
			img.onerror = advance;
			img.src = `web/${index}.webp`;
			cache.push(img);
		};

		loadNext(0);
	}

	preloadImages(() => {
		loadingIndicator.fadeOut(200, function() {
			$(this).remove();
		});
	});

		function formatAge(days) {
			let years = Math.floor(days / 365);
			let rem   = days % 365;
			let months = Math.floor(rem / 30.44);  // average month length
			let d      = Math.floor(rem - (months * 30.44));

			if (years > 0) {
				return `${years} yr, ${months} months & ${d} days`;
			} else {
				return `${months} months & ${d} days`;
			}
		}

		$(".holder").mousemove(function(event) {
			let holderOffset = $(this).offset().left;
			let holderWidth  = $(this).width();

			// X position inside the holder
			let relativeX = event.pageX - holderOffset;

			// Normalise to frame index
			let frameIndex = Math.min(totalImages - 1, Math.floor(relativeX * totalImages / holderWidth));

			mainImage.attr("src", "web/" + frameIndex + ".webp");

			let ageInDays = startAgeDays + (frameIndex * agePerImage);
			textDisplay.text(formatAge(ageInDays));
		});
	
 });
</script>
<div class="holder">
	<div class="loading">Loading images...</div>
	<img class="mainpic" src="web/0.webp" alt="Daily photo sequence">
	<div class="text"></div>
</div>
</body>
</html>
